import { Markup } from 'telegraf'
import { checkSubscribe, createUser, profileUser} from '../db.js'
import { convertSeconds, nowTimeSecond } from '../utils.js'
import config from "config"

const price = config.get('ONE_PRICE')


export const handleNewCommand = async (ctx) => {
    ctx.session.messages = []
    await ctx.reply('–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–±—Ä–æ—à–µ–Ω. –ú–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∑–∞–Ω–æ–≤–æ')

}

export const handleStartCommand = async (ctx) => {
    ctx.session.messages = []
    await createUser(ctx.from.id, ctx.from.first_name)
    const welcomeMessage = `
–ü—Ä–∏–≤–µ—Ç! üëã
–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Telegram –ë–æ—Ç 
Chat GPT-4 Turbo!
    
üé© ChatGPT-4 Turbo ‚Äî —Å–∞–º–∞—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ò–ò (–ò—Å–∫—É—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–µ–∫—Ç–∞) 

‚ÑπÔ∏è –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –ò–ò –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –≤ —Ä–∞–∑–¥–µ–ª–µ 
"–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?"

üéß –ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
    
üîà –ë–æ—Ç –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ –≥–æ–ª–æ—Å–æ–º. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—Å—Ç–æ–º (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏").
    
üéô –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≥–æ–ª–æ—Å, –∫–æ—Ç–æ—Ä—ã–º –±–æ—Ç –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å.
    
üîÑ –ë–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ—Å–µ–¥—ã. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∑–∞–Ω–æ–≤–æ –∏ –ø—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã –±–æ—Ç –∑–∞–±—ã–ª, –æ —á–µ–º –±—ã–ª–∞ –±–µ—Å–µ–¥–∞, –ø—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ –≤ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥—É "–°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç".
    
üí¨ –ù–∞—á–Ω–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å! –ù–∞–ø–∏—à–∏ –±–æ—Ç—É –≤—Å–µ —á—Ç–æ —É–≥–æ–¥–Ω–æ –∏–ª–∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –≥–æ–ª–æ—Å–æ–º.`

    await ctx.reply(welcomeMessage)
}

export const commands = [
    { command: '/start', description: '‚ñ∂Ô∏è –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞' },
    { command: '/new', description: 'üÜï –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç' },
    { command: '/settings', description: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞' },
    { command: '/profile', description: 'üë§ –ü—Ä–æ—Ñ–∏–ª—å' },
    { command: '/help', description: '‚ÑπÔ∏è –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?' },
    { command: '/plan', description: 'üí≥ –ü–æ–¥–ø–∏—Å–∫–∞' }
]

export const handleSettingsCommand = async (ctx) => {
    await ctx.reply(
        '–Ø –º–æ–≥—É –æ—Ç–≤–µ—á–≤—Ç—å –≥–æ–ª–æ—Å–æ–º –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ —Ç–µ–∫—Å—Ç. –ß—Ç–æ –≤—ã–±–µ—Ä–µ—à—å?',
        Markup.inlineKeyboard([
            Markup.button.callback('üîà –ì–æ–ª–æ—Å', 'voice'),
            Markup.button.callback('üí¨ –¢–µ–∫—Å—Ç', 'text')
        ])
    )
}

export const handlePlanCommand = async (ctx) => {
    const checkSub = await checkSubscribe(ctx.from.id, ctx.from.first_name)
    let subscribe = '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞ üò¢'
    let buttonText = '–û—Ñ–æ—Ä–º–∏—Ç—å'
    if(checkSub) {
        subscribe = '–ê–∫—Ç–∏–≤–Ω–∞ ‚úÖ'
        buttonText = '–ü—Ä–æ–¥–ª–∏—Ç—å'
    }
    await ctx.replyWithMarkdown(`–°–µ–π—á–∞—Å –ø–æ–¥–ø–∏—Å–∫–∞ ${subscribe}
    
*–ü–æ–¥–ø–∏—Å–∫–∞ —ç—Ç–æ:*
‚Äî –î–æ—Å—Ç—É–ø –∫ *Chat GPT4 Turbo* –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
‚Äî –û—Ç–≤–µ—Ç—ã –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏
‚Äî –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –≥–æ–ª–æ—Å–æ–º
‚Äî –û–∑–≤—É—á–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç *Chat GPT4 Turbo*
        
–¢—ã –º–æ–∂–µ—à—å ${buttonText} –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –±–æ—Ç–∞ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!`,
        Markup.inlineKeyboard([Markup.button.callback(`üí≥ ${buttonText} –ø–æ–¥–ø–∏—Å–∫—É ‚Äî –∑–∞ ${price}‚ÇΩ`, 'selectPay')])
    )
}

export const handleProfileCommand = async (ctx) => {
    const user = await profileUser(ctx.from.id, ctx.from.first_name)
    const checkSub = await checkSubscribe(ctx.from.id, ctx.from.first_name)
    let subscribe = '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞ üò¢'
    let buttonText = '–û—Ñ–æ—Ä–º–∏—Ç—å'
    if (checkSub) {
        const checkTime = Number(user.subscribe) - nowTimeSecond()
        subscribe = convertSeconds(checkTime)
        buttonText = '–ü—Ä–æ–¥–ª–∏—Ç—å'
    }
    await ctx.reply(`üë§ –ü—Ä–æ—Ñ–∏–ª—å:
    
ID: ${user.telegramId}
–ò–º—è: ${user.name}
–ü–æ–¥–ø–∏—Å–∫–∞: ${subscribe}`,Markup.inlineKeyboard([Markup.button.callback(`üí≥ ${buttonText} –ø–æ–¥–ø–∏—Å–∫—É ‚Äî –∑–∞ ${price}‚ÇΩ`, 'selectPay')]))
}

export const handleHelpCommand = async (ctx) => {
    ctx.session.messages = []
    await createUser(ctx.from.id, ctx.from.first_name)
    const helpMessage = `
**ChatGPT ‚Äì —ç—Ç–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–æ–º–ø–∞–Ω–∏–µ–π OpenAI –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Generative Pre-trained Transformer (GPT). –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–±–ª–∞–¥–∞–µ—Ç ChatGPT:**

**1. –û–±—â–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ –¥–∏–∞–ª–æ–≥–∞:** ChatGPT –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ –±–µ—Å–µ–¥—ã –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–µ–º—ã, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –Ω–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –∏ –∞–¥–∞–ø—Ç–∏—Ä—É—è—Å—å –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –æ–±—â–µ–Ω–∏—è.

2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤: –û–Ω –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç—å–∏, —Ä–∞—Å—Å–∫–∞–∑—ã, –ø–æ—ç–∑–∏—é, –∫–æ–¥ –∏ –¥—Ä—É–≥–∏–µ –≤–∏–¥—ã —Ç–µ–∫—Å—Ç–æ–≤, —Å–ª–µ–¥—É—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏ —Å—Ç–∏–ª—é.

3. –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã: ChatGPT —Å–ø–æ—Å–æ–±–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞—á–∏–Ω–∞—è –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏, —Ç—Ä–µ–±—É—é—â–∏–º–∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

4. –ò–∑—É—á–µ–Ω–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π: AI –º–æ–∂–µ—Ç –∏–∑—É—á–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ –æ–±—ä—è—Å–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∏–¥–µ–∏ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º.

5. –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è: –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –ø–æ–º–æ–≥–∞—è –≤ –æ–±—É—á–µ–Ω–∏–∏.

6. –ü–æ–º–æ—â—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏: ChatGPT –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –Ω–∞–π—Ç–∏ –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–ø–æ—Å–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –¥–∞—Ç—å —Å–æ–≤–µ—Ç—ã –ø–æ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

7. –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è: –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∏–≥—Ä–∞—Ö, —Å–æ–∑–¥–∞–≤–∞—Ç—å —à—É—Ç–∫–∏, –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏ –∏ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º—ã —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π.

8. –ü–æ–º–æ—â—å –≤ —Ä–∞–±–æ—Ç–µ —Å —Ç–µ–∫—Å—Ç–æ–º: ChatGPT –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏, —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ–∫—Å—Ç–∞.

9. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤: GPT —Å–ø–æ—Å–æ–±–µ–Ω –æ–±—â–∞—Ç—å—Å—è –Ω–∞ –º–Ω–æ–≥–∏—Ö —è–∑—ã–∫–∞—Ö, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –ø–æ–ª–µ–∑–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤.

10. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –ë–ª–∞–≥–æ–¥–∞—Ä—è –º–∞—à–∏–Ω–Ω–æ–º—É –æ–±—É—á–µ–Ω–∏—é, ChatGPT –º–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ –Ω—É–∂–¥—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å—Ç–∞–Ω–æ–≤—è—Å—å –±–æ–ª–µ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –æ–±—â–µ–Ω–∏—è –∏ –ø–æ–º–æ—â–∏.

–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤–µ—Ä—Å–∏–∏, –≤—Å–µ –º–æ–¥–µ–ª–∏ GPT –∏–º–µ—é—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –Ω–µ –≤—Å–µ–≥–¥–∞ —Å–ø–æ—Å–æ–±–Ω—ã —Ç–æ—á–Ω–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏ –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ø–æ—ç—Ç–æ–º—É –∏—Ö –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è.`

    await ctx.replyWithMarkdown(helpMessage)
}
